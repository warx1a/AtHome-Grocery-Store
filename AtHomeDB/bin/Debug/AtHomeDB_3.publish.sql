/*
Deployment script for AtHomeDB

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "AtHomeDB"
:setvar DefaultFilePrefix "AtHomeDB"
:setvar DefaultDataPath "C:\Users\stink_000.LJ\AppData\Local\Microsoft\Microsoft SQL Server Local DB\Instances\MSSQLLocalDB"
:setvar DefaultLogPath "C:\Users\stink_000.LJ\AppData\Local\Microsoft\Microsoft SQL Server Local DB\Instances\MSSQLLocalDB"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Rename refactoring operation with key fed54fa4-e7dd-4e2e-a49d-4bd5d68dc148 is skipped, element [dbo].[Users].[Id] (SqlSimpleColumn) will not be renamed to user_id';


GO
PRINT N'Rename refactoring operation with key e6e2a075-bd62-4abb-b3ce-632ad0671eae is skipped, element [dbo].[LineItems].[Id] (SqlSimpleColumn) will not be renamed to receipt_item_id';


GO
PRINT N'Rename refactoring operation with key e1f0f376-5692-46aa-ac6e-9ecd580f8695 is skipped, element [dbo].[LineItems].[product_code] (SqlSimpleColumn) will not be renamed to product_id';


GO
PRINT N'Rename refactoring operation with key 04a0ddc1-c9c5-4510-b62e-0916beef938e is skipped, element [dbo].[Receipts].[Id] (SqlSimpleColumn) will not be renamed to receipt_id';


GO
PRINT N'Rename refactoring operation with key 2cda9dac-e014-49cb-b4a6-a56b61705bc7 is skipped, element [dbo].[Reviews].[Id] (SqlSimpleColumn) will not be renamed to review_id';


GO
PRINT N'Rename refactoring operation with key e2cf1feb-7587-4cc0-a566-63fd54795e87 is skipped, element [dbo].[Reviews].[product_code] (SqlSimpleColumn) will not be renamed to product_id';


GO
PRINT N'Rename refactoring operation with key 29567210-6e4b-4e3d-aaf2-785275c3540d is skipped, element [dbo].[Shipping].[Id] (SqlSimpleColumn) will not be renamed to shipping_id';


GO
PRINT N'Rename refactoring operation with key 3f961769-5446-423b-bdc8-bd405709385b is skipped, element [dbo].[Billing].[Id] (SqlSimpleColumn) will not be renamed to billing_id';


GO
PRINT N'Creating [dbo].[Billing]...';


GO
CREATE TABLE [dbo].[Billing] (
    [billing_id]  INT           NOT NULL,
    [card_number] VARCHAR (50)  NULL,
    [csc]         VARCHAR (50)  NULL,
    [card_name]   VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([billing_id] ASC)
);


GO
PRINT N'Creating [dbo].[LineItems]...';


GO
CREATE TABLE [dbo].[LineItems] (
    [receipt_item_id] INT             NOT NULL,
    [product_id]      INT             NOT NULL,
    [quantity]        INT             NOT NULL,
    [is_taxed]        TINYINT         NOT NULL,
    [product_price]   DECIMAL (18, 2) NOT NULL,
    [receipt_id]      INT             NOT NULL,
    PRIMARY KEY CLUSTERED ([receipt_item_id] ASC)
);


GO
PRINT N'Creating [dbo].[Receipts]...';


GO
CREATE TABLE [dbo].[Receipts] (
    [receipt_id]  INT             NOT NULL,
    [billing_id]  INT             NOT NULL,
    [customer_id] INT             NOT NULL,
    [order_total] DECIMAL (18, 2) NOT NULL,
    [tax_amount]  DECIMAL (18, 2) NOT NULL,
    [shipping_id] INT             NOT NULL,
    PRIMARY KEY CLUSTERED ([receipt_id] ASC)
);


GO
PRINT N'Creating [dbo].[Reviews]...';


GO
CREATE TABLE [dbo].[Reviews] (
    [review_id]          INT           NOT NULL,
    [review_rating]      INT           NOT NULL,
    [product_id]         INT           NOT NULL,
    [review_description] VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([review_id] ASC)
);


GO
PRINT N'Creating [dbo].[Shipping]...';


GO
CREATE TABLE [dbo].[Shipping] (
    [shipping_id] INT           NOT NULL,
    [address]     VARCHAR (MAX) NOT NULL,
    [city]        VARCHAR (MAX) NOT NULL,
    [state]       VARCHAR (MAX) NOT NULL,
    [country]     VARCHAR (MAX) NOT NULL,
    [zipcode]     INT           NOT NULL,
    PRIMARY KEY CLUSTERED ([shipping_id] ASC)
);


GO
PRINT N'Creating [dbo].[Users]...';


GO
CREATE TABLE [dbo].[Users] (
    [user_id]        INT           NOT NULL,
    [user_username]  VARCHAR (50)  NULL,
    [user_password]  VARCHAR (MAX) NULL,
    [user_sessionid] VARCHAR (50)  NULL,
    [user_profile]   VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([user_id] ASC)
);


GO
-- Refactoring step to update target server with deployed transaction logs
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'fed54fa4-e7dd-4e2e-a49d-4bd5d68dc148')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('fed54fa4-e7dd-4e2e-a49d-4bd5d68dc148')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'e6e2a075-bd62-4abb-b3ce-632ad0671eae')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('e6e2a075-bd62-4abb-b3ce-632ad0671eae')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'e1f0f376-5692-46aa-ac6e-9ecd580f8695')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('e1f0f376-5692-46aa-ac6e-9ecd580f8695')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '04a0ddc1-c9c5-4510-b62e-0916beef938e')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('04a0ddc1-c9c5-4510-b62e-0916beef938e')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2cda9dac-e014-49cb-b4a6-a56b61705bc7')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2cda9dac-e014-49cb-b4a6-a56b61705bc7')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'e2cf1feb-7587-4cc0-a566-63fd54795e87')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('e2cf1feb-7587-4cc0-a566-63fd54795e87')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '29567210-6e4b-4e3d-aaf2-785275c3540d')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('29567210-6e4b-4e3d-aaf2-785275c3540d')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '3f961769-5446-423b-bdc8-bd405709385b')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('3f961769-5446-423b-bdc8-bd405709385b')

GO

GO
PRINT N'Update complete.';


GO
